<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <title>Painel Admin - Calendário</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body { margin: 0; font-family: 'Inter', sans-serif; background: #f3f4f6; color: #111827; }
    button, input, textarea { font-family: inherit; }
    .container { max-width: 900px; margin: 2rem auto; padding: 1.5rem; background: #fff; border-radius: 0.75rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    h2,h3,h4{ margin:0.5rem 0; }
    input, textarea, select { width:100%; padding:0.5rem 0.75rem; border:1px solid #d1d5db; border-radius:0.5rem; margin-top:0.25rem; margin-bottom:0.75rem; font-size:1rem; }
    button { padding:0.5rem 1rem; border:none; border-radius:0.5rem; cursor:pointer; font-weight:500; transition: all 0.2s; }
    button.primary { background-color:#4f46e5; color:white; } button.primary:hover{ background-color:#4338ca; }
    button.warning { background-color:#f59e0b; color:white; } button.warning:hover{ background-color:#d97706; }
    button.danger { background-color:#ef4444; color:white; } button.danger:hover{ background-color:#b91c1c; }
    button.cancel { background-color:#9ca3af; color:white; }
    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:1rem; }
    .list-item { border-bottom:1px solid #e5e7eb; padding:0.75rem 0; }
    .list-item audio { width:100%; margin-top:0.5rem; }
    .back-btn { position:fixed; top:1rem; left:1rem; background: linear-gradient(135deg,#6366f1,#818cf8); color:white; padding:0.5rem 1rem; border-radius:0.5rem; box-shadow:0 4px 12px rgba(99,102,241,0.5); border:none; cursor:pointer; z-index:1000; transition: all 0.2s; }
    .back-btn:hover { transform: scale(1.05); }
    progress { width:100%; height:0.75rem; border-radius:0.375rem; overflow:hidden; margin-top:0.25rem; margin-bottom:0.5rem; }
    @media(max-width:640px){ .grid{grid-template-columns:1fr;} }
  </style>
</head>
<body>
  <button class="back-btn" onclick="window.location.href='/'">⬅ Voltar</button>
  <div class="container">
    <div id="loginArea">
      <h3>Login</h3>
      <form id="loginForm">
        <input name="username" placeholder="Usuário" required/>
        <input name="password" type="password" placeholder="Senha" required/>
        <button type="submit" class="primary">Entrar</button>
      </form>
    </div>

    <div id="adminArea" style="display:none">
      <div class="top" style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;">
        <h2>Painel Admin</h2>
        <button id="logoutBtn" class="primary" style="display:none">Sair</button>
      </div>

      <h3>Adicionar / Editar Música</h3>
      <form id="musicForm">
        <input type="hidden" name="id" />
        <div class="grid">
          <div>
            <label>Data</label>
            <input type="date" name="data" required />
          </div>
          <div>
            <label>Posição</label>
            <input name="posicao" placeholder="1, 2, ..." />
          </div>
        </div>
        <input name="titulo" placeholder="Título da música"/>
        <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
          <input id="audioUrl" name="audio" placeholder="URL do arquivo .mp3" style="flex:1"/>
          <div style="display:flex; flex-direction:column; gap:0.5rem; width:150px;">
            <input id="audioFile" type="file" accept="audio/*" />
            <button id="uploadBtn" type="button" class="primary">Upload</button>
            <progress id="uploadProgress" value="0" max="100" style="display:none;"></progress>
          </div>
        </div>
        <input name="capa" placeholder="URL da capa (opcional)"/>
        <textarea name="letra" rows="6" placeholder="Letra (opcional)"></textarea>
        <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
          <button type="submit" id="saveBtn" class="primary">Salvar</button>
          <button id="cancelEditBtn" type="button" class="cancel" style="display:none;">Cancelar</button>
          <button id="previewBtn" type="button" class="warning">Preview</button>
        </div>
      </form>

      <hr style="margin:1rem 0"/>
      <h4>Músicas existentes</h4>
      <div id="listaMusicas"></div>

      <hr style="margin:1rem 0"/>
      <h4>Últimos acessos</h4>
      <div id="listaLogs"></div>
    </div>
  </div>

  <script>
    const loginForm = document.getElementById("loginForm");
    const musicForm = document.getElementById("musicForm");
    const loginArea = document.getElementById("loginArea");
    const adminArea = document.getElementById("adminArea");
    const logoutBtn = document.getElementById("logoutBtn");
    const listaMusicas = document.getElementById("listaMusicas");
    const audioFile = document.getElementById("audioFile");
    const uploadBtn = document.getElementById("uploadBtn");
    const uploadProgress = document.getElementById("uploadProgress");
    const audioUrlInput = document.getElementById("audioUrl");
    const previewBtn = document.getElementById("previewBtn");
    const saveBtn = document.getElementById("saveBtn");
    const cancelEditBtn = document.getElementById("cancelEditBtn");

    // Dados em memória
    let musicas = [
      { id:1, data:"2025-08-13", posicao:"1", titulo:"Bom Dia", audio:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3", capa:"", letra:"Bom dia galera" },
      { id:2, data:"2025-08-13", posicao:"2", titulo:"Dedicação Especial", audio:"https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3", capa:"", letra:"Para você que merece" }
    ];
    let logs = [];

    function addLog(){
      const now = new Date().toLocaleString();
      logs.unshift({ ip:"IP: Desconhecido", userAgent: navigator.userAgent, hora: now });
      renderLogs();
    }

    function renderLogs(){
      const container = document.getElementById("listaLogs");
      container.innerHTML="";
      logs.forEach(l=>{
        const div = document.createElement("div");
        div.style.fontFamily="monospace";
        div.style.marginBottom="0.25rem";
        div.textContent = `${l.ip} | ${l.userAgent} | ${l.hora}`;
        container.appendChild(div);
      });
    }

    function carregarLista(){
      listaMusicas.innerHTML="";
      musicas.forEach(m=>{
        const div = document.createElement("div");
        div.className="list-item";
        div.innerHTML=`
          <strong>${m.data} - ${m.titulo}</strong>
          ${m.posicao?`<span> | Posição: ${m.posicao}</span>`:""}
          <div>
            <audio controls src="${m.audio}"></audio>
            <div style="margin-top:0.25rem;">
              <button class="primary" onclick="editar(${m.id})">Editar</button>
              <button class="danger" onclick="deletar(${m.id})">Deletar</button>
            </div>
          </div>
        `;
        listaMusicas.appendChild(div);
      });
    }

    // Login simples (fake)
    loginForm.onsubmit = (e)=>{
      e.preventDefault();
      loginArea.style.display="none";
      adminArea.style.display="block";
      logoutBtn.style.display="inline-block";
      carregarLista();
      addLog();
    };

    logoutBtn.onclick = ()=>{
      loginArea.style.display="block";
      adminArea.style.display="none";
    };

    function editar(id){
      const m = musicas.find(m=>m.id===id);
      if(!m) return;
      musicForm.id.value = m.id;
      musicForm.data.value = m.data;
      musicForm.posicao.value = m.posicao;
      musicForm.titulo.value = m.titulo;
      musicForm.audio.value = m.audio;
      musicForm.capa.value = m.capa;
      musicForm.letra.value = m.letra;
      cancelEditBtn.style.display="inline-block";
    }

    cancelEditBtn.onclick = ()=>{
      musicForm.reset();
      cancelEditBtn.style.display="none";
      musicForm.id.value = "";
    };

    function deletar(id){
      if(!confirm("Deseja realmente deletar?")) return;
      musicas = musicas.filter(m=>m.id!==id);
      carregarLista();
    }

    musicForm.onsubmit = (e)=>{
      e.preventDefault();
      const id = musicForm.id.value;
      const nova = {
        id: id ? parseInt(id) : Date.now(),
        data: musicForm.data.value,
        posicao: musicForm.posicao.value,
        titulo: musicForm.titulo.value,
        audio: musicForm.audio.value,
        capa: musicForm.capa.value,
        letra: musicForm.letra.value
      };
      if(id){
        musicas = musicas.map(m=>m.id===nova.id ? nova : m);
      } else {
        musicas.push(nova);
      }
      musicForm.reset();
      cancelEditBtn.style.display="none";
      carregarLista();
    };

    // Preview
    previewBtn.onclick = ()=>{
      const url = musicForm.audio.value;
      if(!url) return alert("Informe o URL da música");
      const win = window.open("", "_blank", "width=400,height=200");
      win.document.write(`<audio controls autoplay src="${url}" style="width:100%;"></audio>`);
    };

    // Fake upload
    uploadBtn.onclick = ()=>{
      const file = audioFile.files[0];
      if(!file) return alert("Selecione um arquivo");
      uploadProgress.style.display="block";
      let progress = 0;
      const interval = setInterval(()=>{
        progress += Math.random()*10;
        if(progress>=100){ progress=100; clearInterval(interval); audioUrlInput.value = URL.createObjectURL(file); }
        uploadProgress.value = progress;
      }, 200);
    };

  </script>
</body>
</html>
