<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <title>Painel Admin - Calendário</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    /* Reset e fontes */
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: #f3f4f6;
      color: #111827;
    }
    button, input, textarea {
      font-family: inherit;
    }

    /* Container */
    .container {
      max-width: 900px;
      margin: 2rem auto;
      padding: 1.5rem;
      background: #fff;
      border-radius: 0.75rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    h2, h3, h4 {
      margin: 0.5rem 0;
    }

    /* Inputs e botões */
    input, textarea, select {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      margin-top: 0.25rem;
      margin-bottom: 0.75rem;
      font-size: 1rem;
    }

    button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }

    button.primary {
      background-color: #4f46e5;
      color: white;
    }
    button.primary:hover {
      background-color: #4338ca;
    }

    button.warning {
      background-color: #f59e0b;
      color: white;
    }
    button.warning:hover {
      background-color: #d97706;
    }

    button.danger {
      background-color: #ef4444;
      color: white;
    }
    button.danger:hover {
      background-color: #b91c1c;
    }

    button.cancel {
      background-color: #9ca3af;
      color: white;
    }

    /* Grid */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
    }

    /* Lista */
    .list-item {
      border-bottom: 1px solid #e5e7eb;
      padding: 0.75rem 0;
    }
    .list-item audio {
      width: 100%;
      margin-top: 0.5rem;
    }

    /* Botão voltar */
    .back-btn {
      position: fixed;
      top: 1rem;
      left: 1rem;
      background: linear-gradient(135deg, #6366f1, #818cf8);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 12px rgba(99,102,241,0.5);
      border: none;
      cursor: pointer;
      z-index: 1000;
      transition: all 0.2s;
    }
    .back-btn:hover {
      transform: scale(1.05);
    }

    /* Calendar */
    #calendarContainer {
      margin: 1rem 0;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.25rem;
    }
    .day {
      background: #e5e7eb;
      padding: 0.5rem;
      text-align: center;
      border-radius: 0.25rem;
      cursor: pointer;
      position: relative;
    }
    .day.today {
      border: 2px solid #4f46e5;
    }
    .day.event {
      background-color: #ffd700;
    }
    .day.selected {
      border: 2px solid #f59e0b;
    }

    /* Tabs */
    #tabsContainer {
      margin: 1rem 0;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    #tabsContainer button {
      background: #e5e7eb;
      color: #111827;
      padding: 0.25rem 0.75rem;
    }
    #tabsContainer button.active {
      background: #4f46e5;
      color: white;
    }

    /* Player */
    #playerContainer {
      margin-top: 1rem;
    }
    #lyrics {
      white-space: pre-wrap;
      margin-top: 0.5rem;
      background: #f9fafb;
      padding: 0.5rem;
      border-radius: 0.25rem;
    }

    /* Mobile */
    @media(max-width: 640px){
      .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <button class="back-btn" onclick="window.location.href='/'">⬅ Voltar</button>

  <div class="container">
    <div id="loginArea">
      <h3>Login</h3>
      <form id="loginForm">
        <input name="username" placeholder="Usuário" required/>
        <input name="password" type="password" placeholder="Senha" required/>
        <button type="submit" class="primary">Entrar</button>
      </form>
    </div>

    <div id="adminArea" style="display:none">
      <div class="top" style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;">
        <h2>Painel Admin</h2>
        <button id="logoutBtn" class="primary" style="display:none">Sair</button>
      </div>

      <h3>Adicionar / Editar Música</h3>
      <form id="musicForm">
        <input type="hidden" name="id" />
        <div class="grid">
          <div>
            <label>Data</label>
            <input type="date" name="data" required />
          </div>
          <div>
            <label>Posição</label>
            <input name="posicao" placeholder="1, 2, ..." />
          </div>
        </div>
        <input name="titulo" placeholder="Título da música"/>
        <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
          <input id="audioUrl" name="audio" placeholder="URL do arquivo .mp3" style="flex:1"/>
          <div style="display:flex; flex-direction:column; gap:0.5rem; width:150px;">
            <input id="audioFile" type="file" accept="audio/*" />
            <button id="uploadBtn" type="button" class="primary">Upload</button>
            <progress id="uploadProgress" value="0" max="100" style="display:none;"></progress>
          </div>
        </div>
        <input name="capa" placeholder="URL da capa (opcional)"/>
        <textarea name="letra" rows="6" placeholder="Letra (opcional)"></textarea>
        <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
          <button type="submit" id="saveBtn" class="primary">Salvar</button>
          <button id="cancelEditBtn" type="button" class="cancel" style="display:none;">Cancelar</button>
          <button id="previewBtn" type="button" class="warning">Preview</button>
        </div>
      </form>

      <hr style="margin:1rem 0"/>
      <h4>Músicas existentes</h4>
      <div id="listaMusicas"></div>

      <hr style="margin:1rem 0"/>
      <h4>Últimos acessos</h4>
      <div id="listaLogs"></div>

      <hr style="margin:1rem 0"/>
      <h3>Calendário de Músicas</h3>
      <div id="calendarContainer">
        <div id="calendar" class="calendar"></div>
      </div>
      <div id="tabsContainer"></div>
      <div id="playerContainer">
        <h4 id="songTitle">Selecione um dia</h4>
        <audio id="audioPlay" controls src="" style="width:100%; display:none;"></audio>
        <div id="lyrics"></div>
      </div>
    </div>
  </div>

  <script>
    // ---- LOGIN / ADMIN ----
    const loginForm = document.getElementById("loginForm");
    const musicForm = document.getElementById("musicForm");
    const loginArea = document.getElementById("loginArea");
    const adminArea = document.getElementById("adminArea");
    const logoutBtn = document.getElementById("logoutBtn");
    const listaMusicas = document.getElementById("listaMusicas");
    const audioFile = document.getElementById("audioFile");
    const uploadBtn = document.getElementById("uploadBtn");
    const uploadProgress = document.getElementById("uploadProgress");
    const cancelEditBtn = document.getElementById("cancelEditBtn");
    const previewBtn = document.getElementById("previewBtn");

    let musicas = [];
    let logs = [];

    loginForm.addEventListener("submit", e=>{
      e.preventDefault();
      const u = loginForm.username.value;
      const p = loginForm.password.value;
      if(u==="admin" && p==="admin123"){ // Simples
        loginArea.style.display="none";
        adminArea.style.display="block";
        logoutBtn.style.display="inline-block";
        renderMusicas();
        renderLogs();
        renderCalendar();
      } else {
        alert("Usuário ou senha inválidos");
      }
    });

    logoutBtn.addEventListener("click", ()=>{
      loginArea.style.display="block";
      adminArea.style.display="none";
    });

    function renderMusicas(){
      if(!musicas.length){
        listaMusicas.innerHTML="<p>Nenhuma música cadastrada.</p>";
        return;
      }
      listaMusicas.innerHTML="";
      musicas.forEach((m,i)=>{
        const div=document.createElement("div");
        div.className="list-item";
        div.innerHTML = `<b>${m.data}</b> - ${m.titulo} 
          <button onclick="editMusica(${i})">Editar</button>
          <button onclick="deleteMusica(${i})" class="danger">Excluir</button>
          <audio controls src="${m.audio}"></audio>`;
        listaMusicas.appendChild(div);
      });
    }

    function renderLogs(){
      const logContainer = document.getElementById("listaLogs");
      if(!logs.length){
        logContainer.innerHTML="<p>Nenhum acesso recente.</p>";
        return;
      }
      logContainer.innerHTML = logs.map(l=>`<div>${l}</div>`).join("");
    }

    musicForm.addEventListener("submit", e=>{
      e.preventDefault();
      const formData = new FormData(musicForm);
      const id = formData.get("id");
      const novaMusica = {
        id: Date.now(),
        data: formData.get("data"),
        posicao: formData.get("posicao"),
        titulo: formData.get("titulo"),
        audio: formData.get("audio"),
        capa: formData.get("capa"),
        letra: formData.get("letra")
      };
      if(id){
        const idx = musicas.findIndex(m=>m.id==id);
        musicas[idx] = novaMusica;
      } else {
        musicas.push(novaMusica);
      }
      musicForm.reset();
      cancelEditBtn.style.display="none";
      renderMusicas();
      renderCalendar();
    });

    cancelEditBtn.addEventListener("click", ()=>{
      musicForm.reset();
      cancelEditBtn.style.display="none";
    });

    function editMusica(idx){
      const m = musicas[idx];
      musicForm.id.value = m.id;
      musicForm.data.value = m.data;
      musicForm.posicao.value = m.posicao;
      musicForm.titulo.value = m.titulo;
      musicForm.audio.value = m.audio;
      musicForm.capa.value = m.capa;
      musicForm.letra.value = m.letra;
      cancelEditBtn.style.display="inline-block";
    }

    function deleteMusica(idx){
      if(confirm("Deseja realmente excluir esta música?")){
        musicas.splice(idx,1);
        renderMusicas();
        renderCalendar();
      }
    }

    uploadBtn.addEventListener("click", ()=>{
      const file = audioFile.files[0];
      if(!file){ alert("Selecione um arquivo"); return;}
      uploadProgress.style.display="block";
      let reader = new FileReader();
      reader.onprogress = e=>{
        if(e.lengthComputable){
          uploadProgress.value = (e.loaded/e.total)*100;
        }
      };
      reader.onloadend = e=>{
        musicForm.audio.value = reader.result;
        uploadProgress.style.display="none";
      };
      reader.readAsDataURL(file);
    });

    previewBtn.addEventListener("click", ()=>{
      const src = musicForm.audio.value;
      if(!src){ alert("Insira o áudio"); return;}
      const audioEl = document.getElementById("audioPlay");
      audioEl.src = src;
      audioEl.style.display="block";
      audioEl.play();
    });

    // ---- CALENDÁRIO ----
    const calendarEl = document.getElementById("calendar");
    const tabsContainer = document.getElementById("tabsContainer");
    const songTitle = document.getElementById("songTitle");
    const audioPlay = document.getElementById("audioPlay");
    const lyricsEl = document.getElementById("lyrics");

    function renderCalendar(){
      calendarEl.innerHTML="";
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth();
      const firstDay = new Date(year, month, 1).getDay(); // 0-dom
      const daysInMonth = new Date(year, month+1,0).getDate();

      // preenche dias vazios
      for(let i=0;i<firstDay;i++){
        const d = document.createElement("div");
        calendarEl.appendChild(d);
      }

      for(let d=1; d<=daysInMonth; d++){
        const dayEl = document.createElement("div");
        dayEl.className="day";
        dayEl.textContent = d;
        const dateStr = `${year}-${String(month+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
        const musicsOfDay = musicas.filter(m=>m.data===dateStr);
        if(musicsOfDay.length) dayEl.classList.add("event");
        if(d===today.getDate()) dayEl.classList.add("today");
        dayEl.addEventListener("click", ()=>{
          selectDay(dateStr, musicsOfDay, dayEl);
        });
        calendarEl.appendChild(dayEl);
      }
    }

    function selectDay(dateStr, musics, dayEl){
      // desmarca anterior
      document.querySelectorAll(".day.selected").forEach(d=>d.classList.remove("selected"));
      dayEl.classList.add("selected");

      tabsContainer.innerHTML="";
      if(!musics.length){
        tabsContainer.innerHTML="<p>Nenhuma música para este dia.</p>";
        songTitle.textContent = "Nenhuma música selecionada";
        audioPlay.style.display="none";
        lyricsEl.textContent="";
        return;
      }
      musics.forEach((m,i)=>{
        const btn = document.createElement("button");
        btn.textContent = m.posicao ? `Pos ${m.posicao}` : `Música ${i+1}`;
        if(i===0) btn.classList.add("active");
        btn.addEventListener("click", ()=>{
          document.querySelectorAll("#tabsContainer button").forEach(b=>b.classList.remove("active"));
          btn.classList.add("active");
          playMusic(m);
        });
        tabsContainer.appendChild(btn);
      });
      playMusic(musics[0]);
    }

    function playMusic(m){
      songTitle.textContent = m.titulo;
      audioPlay.src = m.audio;
      audioPlay.style.display="block";
      audioPlay.play();
      lyricsEl.textContent = m.letra || "";
    }

    // Inicial
    renderCalendar();
  </script>
</body>
</html>
